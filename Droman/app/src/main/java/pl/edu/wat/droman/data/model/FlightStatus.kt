package pl.edu.wat.droman.data.model

import com.google.gson.GsonBuilder
import dji.common.flightcontroller.FlightControllerState

data class FlightStatus(
    val activeBrakeEngaged: Boolean,
    val aircraftHeadDirection: Long,
    val aircraftLocationAltitude: Double,
    val aircraftLocationLatitude: Double,
    val aircraftLocationLongitude: Double,
    val attitudePitch: Double,
    val attitudeRoll: Double,
    val attitudeYaw: Double,
    val batteryThresholdBehavior: String,
    val doesUltrasonicHaveError: Boolean,
    val flightCount: Long,
    val flightLogIndex: Long,
    val flightMode: String,
    val flightModeString: String,
    val flightTimeInSeconds: Long,
    val flightWindWarning: String,
    val goHomeAssessmentBatteryPercentageNeededToGoHome: Long,
    val goHomeAssessmentBatteryPercentageNeededToLandFromCurrentHeight: Long,
    val goHomeAssessmentMaxRadiusAircraftCanFlyAndGoHome: Double,
    val goHomeAssessmentRemainingFlightTime: Long,
    val goHomeAssessmentSmartRTHCountdown: Long,
    val goHomeAssessmentSmartRTHState: String,
    val goHomeAssessmentTimeNeededToGoHome: Long,
    val goHomeAssessmentTimeNeededToLandFromCurrentHeight: Long,
    val goHomeExecutionState: String,
    val goHomeHeight: Long,
    val gpsSignalLevel: String,
    val hasReachedMaxFlightHeight: Boolean,
    val hasReachedMaxFlightRadius: Boolean,
    val homeLocationLatitude: Double,
    val homeLocationLongitude: Double,
    val isFailsafeEnabled: Boolean,
    val isFlying: Boolean,
    val isGoingHome: Boolean,
    val isHomeLocationSet: Boolean,
    val isIMUPreheating: Boolean,
    val isLowerThanBatteryWarningThreshold: Boolean,
    val isLowerThanSeriousBatteryWarningThreshold: Boolean,
    val isMultipModeOpen: Boolean,
    val isUltrasonicBeingUsed: Boolean,
    val isVisionPositioningSensorBeingUsed: Boolean,
    val islandingConfirmationNeeded: Boolean,
    val motorsOn: Boolean,
    val orientationMode: String,
    val satelliteCount: Long,
    val takeoffLocationAltitude: Double,
    val ultrasonicHeightInMeters: Double,
    val velocityX: Double,
    val velocityY: Double,
    val velocityZ: Double
) {

    companion object {
        fun gen(flightState: FlightControllerState): FlightStatus {
            return FlightStatus(
                activeBrakeEngaged = flightState.isActiveBrakeEngaged,
                aircraftHeadDirection = flightState.aircraftHeadDirection.toLong(),
                aircraftLocationAltitude = flightState.aircraftLocation.altitude.toDouble(),
                aircraftLocationLatitude = flightState.aircraftLocation.latitude,
                aircraftLocationLongitude = flightState.aircraftLocation.longitude,
                attitudePitch = flightState.attitude.pitch,
                attitudeRoll = flightState.attitude.roll,
                attitudeYaw = flightState.attitude.yaw,
                batteryThresholdBehavior = flightState.batteryThresholdBehavior.name,
                doesUltrasonicHaveError = flightState.doesUltrasonicHaveError(),
                flightCount = flightState.flightCount.toLong(),
                flightLogIndex = flightState.flightLogIndex.toLong(),
                flightMode = flightState.flightMode.name,
                flightModeString = flightState.flightModeString,
                flightTimeInSeconds = flightState.flightTimeInSeconds.toLong(),
                flightWindWarning = flightState.flightWindWarning.name,
                goHomeAssessmentBatteryPercentageNeededToGoHome = flightState.goHomeAssessment.batteryPercentageNeededToGoHome.toLong(),
                goHomeAssessmentBatteryPercentageNeededToLandFromCurrentHeight = flightState.goHomeAssessment.batteryPercentageNeededToLandFromCurrentHeight.toLong(),
                goHomeAssessmentMaxRadiusAircraftCanFlyAndGoHome = flightState.goHomeAssessment.maxRadiusAircraftCanFlyAndGoHome.toDouble(),
                goHomeAssessmentRemainingFlightTime = flightState.goHomeAssessment.remainingFlightTime.toLong(),
                goHomeAssessmentSmartRTHCountdown = flightState.goHomeAssessment.smartRTHCountdown.toLong(),
                goHomeAssessmentSmartRTHState = flightState.goHomeAssessment.smartRTHState.name,
                goHomeAssessmentTimeNeededToGoHome = flightState.goHomeAssessment.timeNeededToGoHome.toLong(),
                goHomeAssessmentTimeNeededToLandFromCurrentHeight = flightState.goHomeAssessment.timeNeededToLandFromCurrentHeight.toLong(),
                goHomeExecutionState = flightState.goHomeExecutionState.name,
                goHomeHeight = flightState.goHomeHeight.toLong(),
                gpsSignalLevel = flightState.gpsSignalLevel.name,
                hasReachedMaxFlightHeight = flightState.hasReachedMaxFlightHeight(),
                hasReachedMaxFlightRadius = flightState.hasReachedMaxFlightRadius(),
                homeLocationLatitude = flightState.homeLocation.latitude,
                homeLocationLongitude = flightState.homeLocation.longitude,
                isFailsafeEnabled = flightState.isFailsafeEnabled,
                isFlying = flightState.isFlying,
                isGoingHome = flightState.isGoingHome,
                isHomeLocationSet = flightState.isHomeLocationSet,
                isIMUPreheating = flightState.isIMUPreheating,
                isLowerThanBatteryWarningThreshold = flightState.isLowerThanBatteryWarningThreshold,
                isLowerThanSeriousBatteryWarningThreshold = flightState.isLowerThanSeriousBatteryWarningThreshold,
                isMultipModeOpen = flightState.isMultipleModeOpen,
                isUltrasonicBeingUsed = flightState.isUltrasonicBeingUsed,
                isVisionPositioningSensorBeingUsed = flightState.isVisionPositioningSensorBeingUsed,
                islandingConfirmationNeeded = flightState.isLandingConfirmationNeeded,
                motorsOn = flightState.areMotorsOn(),
                orientationMode = flightState.orientationMode.name,
                satelliteCount = flightState.satelliteCount.toLong(),
                takeoffLocationAltitude = flightState.takeoffLocationAltitude.toDouble(),
                ultrasonicHeightInMeters = flightState.ultrasonicHeightInMeters.toDouble(),
                velocityX = flightState.velocityX.toDouble(),
                velocityY = flightState.velocityY.toDouble(),
                velocityZ = flightState.velocityZ.toDouble(),
            )

        }
    }

    fun toJson(): String {
        return GsonBuilder().serializeSpecialFloatingPointValues().create().toJson(this)
    }

}
